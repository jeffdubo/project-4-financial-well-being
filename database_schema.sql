-- Project 4: Financial Well Being in the U.S.

-- This SQL file includes:
-- 1. PostgreSQL code to create the database table
-- 2. PostgreSQL code to review and verify imported data

-- 1. Create database table

CREATE TABLE FWB (
    PUF_ID INT NOT NULL,
    sample INT NOT NULL,
    fpl INT NOT NULL,
    SWB_1 INT NOT NULL,
    SWB_2 INT NOT NULL,
    SWB_3 INT NOT NULL,
    FWBscore INT NOT NULL,
    FWB1_1 INT NOT NULL,
    FWB1_2 INT NOT NULL,
    FWB1_3 INT NOT NULL,
    FWB1_4 INT NOT NULL,
    FWB1_5 INT NOT NULL,
    FWB1_6 INT NOT NULL,
    FWB2_1 INT NOT NULL,
    FWB2_2 INT NOT NULL,
    FWB2_3 INT NOT NULL,
    FWB2_4 INT NOT NULL,
    FSscore INT NOT NULL,
    FS1_1 INT NOT NULL,
    FS1_2 INT NOT NULL,
    FS1_3 INT NOT NULL,
    FS1_4 INT NOT NULL,
    FS1_5 INT NOT NULL,
    FS1_6 INT NOT NULL,
    FS1_7 INT NOT NULL,
    FS2_1 INT NOT NULL,
    FS2_2 INT NOT NULL,
    FS2_3 INT NOT NULL,
    SUBKNOWL1 INT NOT NULL,
    ACT1_1 INT NOT NULL,
    ACT1_2 INT NOT NULL,
    FINGOALS INT NOT NULL,
    PROPPLAN_1 INT NOT NULL,
    PROPPLAN_2 INT NOT NULL,
    PROPPLAN_3 INT NOT NULL,
    PROPPLAN_4 INT NOT NULL,
    MANAGE1_1 INT NOT NULL,
    MANAGE1_2 INT NOT NULL,
    MANAGE1_3 INT NOT NULL,
    MANAGE1_4 INT NOT NULL,
    SAVEHABIT INT NOT NULL,
    FRUGALITY INT NOT NULL,
    AUTOMATED_1 INT NOT NULL,
    AUTOMATED_2 INT NOT NULL,
    ASK1_1 INT NOT NULL,
    ASK1_2 INT NOT NULL,
    SUBNUMERACY2 INT NOT NULL,
    SUBNUMERACY1 INT NOT NULL,
    CHANGEABLE INT NOT NULL,
    GOALCONF INT NOT NULL,
    LMscore INT NOT NULL,
    FINKNOWL1 INT NOT NULL,
    FINKNOWL2 INT NOT NULL,
    FINKNOWL3 INT NOT NULL,
    FK1correct INT NOT NULL,
    FK2correct INT NOT NULL,
    FK3correct INT NOT NULL,
    KHscore FLOAT NOT NULL,
    KHKNOWL1 INT NOT NULL,
    KHKNOWL2 INT NOT NULL,
    KHKNOWL3 INT NOT NULL,
    KHKNOWL4 INT NOT NULL,
    KHKNOWL5 INT NOT NULL,
    KHKNOWL6 INT NOT NULL,
    KHKNOWL7 INT NOT NULL,
    KHKNOWL8 INT NOT NULL,
    KHKNOWL9 INT NOT NULL,
    KH1correct INT NOT NULL,
    KH2correct INT NOT NULL,
    KH3correct INT NOT NULL,
    KH4correct INT NOT NULL,
    KH5correct INT NOT NULL,
    KH6correct INT NOT NULL,
    KH7correct INT NOT NULL,
    KH8correct INT NOT NULL,
    KH9correct INT NOT NULL,
    ENDSMEET INT NOT NULL,
    HOUSING INT NOT NULL,
    LIVINGARRANGEMENT INT NOT NULL,
    HOUSERANGES INT NOT NULL,
    IMPUTATION_FLAG INT NOT NULL,
    VALUERANGES INT NOT NULL,
    MORTGAGE INT NOT NULL,
    SAVINGSRANGES INT NOT NULL,
    PRODHAVE_1 INT NOT NULL,
    PRODHAVE_2 INT NOT NULL,
    PRODHAVE_3 INT NOT NULL,
    PRODHAVE_4 INT NOT NULL,
    PRODHAVE_5 INT NOT NULL,
    PRODHAVE_6 INT NOT NULL,
    PRODHAVE_7 INT NOT NULL,
    PRODHAVE_8 INT NOT NULL,
    PRODHAVE_9 INT NOT NULL,
    PRODUSE_1 INT NOT NULL,
    PRODUSE_2 INT NOT NULL,
    PRODUSE_3 INT NOT NULL,
    PRODUSE_4 INT NOT NULL,
    PRODUSE_5 INT NOT NULL,
    PRODUSE_6 INT NOT NULL,
    CONSPROTECT1 INT NOT NULL,
    CONSPROTECT2 INT NOT NULL,
    CONSPROTECT3 INT NOT NULL,
    EARNERS INT NOT NULL,
    VOLATILITY INT NOT NULL,
    SNAP INT NOT NULL,
    MATHARDSHIP_1 INT NOT NULL,
    MATHARDSHIP_2 INT NOT NULL,
    MATHARDSHIP_3 INT NOT NULL,
    MATHARDSHIP_4 INT NOT NULL,
    MATHARDSHIP_5 INT NOT NULL,
    MATHARDSHIP_6 INT NOT NULL,
    COLLECT INT NOT NULL,
    REJECTED_1 INT NOT NULL,
    REJECTED_2 INT NOT NULL,
    ABSORBSHOCK INT NOT NULL,
    BENEFITS_1 INT NOT NULL,
    BENEFITS_2 INT NOT NULL,
    BENEFITS_3 INT NOT NULL,
    BENEFITS_4 INT NOT NULL,
    BENEFITS_5 INT NOT NULL,
    FRAUD2 INT NOT NULL,
    COVERCOSTS INT NOT NULL,
    BORROW_1 INT NOT NULL,
    BORROW_2 INT NOT NULL,
    SHOCKS_1 INT NOT NULL,
    SHOCKS_2 INT NOT NULL,
    SHOCKS_3 INT NOT NULL,
    SHOCKS_4 INT NOT NULL,
    SHOCKS_5 INT NOT NULL,
    SHOCKS_6 INT NOT NULL,
    SHOCKS_7 INT NOT NULL,
    SHOCKS_8 INT NOT NULL,
    SHOCKS_9 INT NOT NULL,
    SHOCKS_10 INT NOT NULL,
    SHOCKS_11 INT NOT NULL,
    SHOCKS_12 INT NOT NULL,
    MANAGE2 INT NOT NULL,
    PAIDHELP INT NOT NULL,
    HSLOC INT NOT NULL,
    PAREDUC INT NOT NULL,
    FINSOC2_1 INT NOT NULL,
    FINSOC2_2 INT NOT NULL,
    FINSOC2_3 INT NOT NULL,
    FINSOC2_4 INT NOT NULL,
    FINSOC2_5 INT NOT NULL,
    FINSOC2_6 INT NOT NULL,
    FINSOC2_7 INT NOT NULL,
    OBJNUMERACY1 INT NOT NULL,
    ON2correct INT NOT NULL,
    ON1correct INT NOT NULL,
    MATERIALISM_1 INT NOT NULL,
    MATERIALISM_2 INT NOT NULL,
    MATERIALISM_3 INT NOT NULL,
    CONNECT INT NOT NULL,
    HEALTH INT NOT NULL,
    SCFHORIZON INT NOT NULL,
    DISCOUNT INT NOT NULL,
    MEMLOSS INT NOT NULL,
    DISTRESS INT NOT NULL,
    SELFCONTROL_1 INT NOT NULL,
    SELFCONTROL_2 INT NOT NULL,
    SELFCONTROL_3 INT NOT NULL,
    OUTLOOK_1 INT NOT NULL,
    OUTLOOK_2 INT NOT NULL,
    INTERCONNECTIONS_1 INT NOT NULL,
    INTERCONNECTIONS_2 INT NOT NULL,
    INTERCONNECTIONS_3 INT NOT NULL,
    INTERCONNECTIONS_4 INT NOT NULL,
    INTERCONNECTIONS_5 INT NOT NULL,
    INTERCONNECTIONS_6 INT NOT NULL,
    INTERCONNECTIONS_7 INT NOT NULL,
    INTERCONNECTIONS_8 INT NOT NULL,
    INTERCONNECTIONS_9 INT NOT NULL,
    INTERCONNECTIONS_10 INT NOT NULL,
    PEM INT NOT NULL,
    HOUSESAT INT NOT NULL,
    SOCSEC1 INT NOT NULL,
    SOCSEC2 INT NOT NULL,
    SOCSEC3 INT NOT NULL,
    LIFEEXPECT INT NOT NULL,
    HHEDUC INT NOT NULL,
    KIDS_NoChildren INT NOT NULL,
    KIDS_1 INT NOT NULL,
    KIDS_2 INT NOT NULL,
    KIDS_3 INT NOT NULL,
    KIDS_4 INT NOT NULL,
    EMPLOY INT NOT NULL,
    EMPLOY1_1 INT NOT NULL,
    EMPLOY1_2 INT NOT NULL,
    EMPLOY1_3 INT NOT NULL,
    EMPLOY1_4 INT NOT NULL,
    EMPLOY1_5 INT NOT NULL,
    EMPLOY1_6 INT NOT NULL,
    EMPLOY1_7 INT NOT NULL,
    EMPLOY1_8 INT NOT NULL,
    EMPLOY1_9 INT NOT NULL,
    RETIRE INT NOT NULL,
    MILITARY INT NOT NULL,
    Military_Status INT NOT NULL,
    agecat INT NOT NULL,
    generation INT NOT NULL,
    PPEDUC INT NOT NULL,
    PPETHM INT NOT NULL,
    PPGENDER INT NOT NULL,
    PPHHSIZE INT NOT NULL,
    PPINCIMP INT NOT NULL,
    PPMARIT INT NOT NULL,
    PPMSACAT INT NOT NULL,
    PPREG4 INT NOT NULL,
    PPREG9 INT NOT NULL,
    PPT01 INT NOT NULL,
    PPT25 INT NOT NULL,
    PPT612 INT NOT NULL,
    PPT1317 INT NOT NULL,
    PPT18OV INT NOT NULL,
    PCTLT200FPL INT NOT NULL,
    finalwt FLOAT NOT NULL
);

-- 2. Review and verify imported data

SELECT * FROM FWB;    --6394 records

-- 2.1 Verify statistics in CFPB rerport
SELECT
	PERCENTILE_CONT(0.10) WITHIN GROUP (ORDER BY FWBscore ASC), -- 48
	PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY FWBscore ASC), -- 48
	PERCENTILE_CONT(0.50) WITHIN GROUP (ORDER BY FWBscore ASC), -- 56
	PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY FWBscore ASC), -- 65
	PERCENTILE_CONT(0.90) WITHIN GROUP (ORDER BY FWBscore ASC)  -- 48
FROM FWB;

SELECT
	PERCENTILE_CONT(0.10) WITHIN GROUP (ORDER BY FWBscore * finalwt ASC), -- 24.75
	PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY FWBscore * finalwt ASC), -- 32.99
	PERCENTILE_CONT(0.50) WITHIN GROUP (ORDER BY FWBscore * finalwt ASC), -- 46.17
	PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY FWBscore * finalwt ASC), -- 66.92
	PERCENTILE_CONT(0.90) WITHIN GROUP (ORDER BY FWBscore * finalwt ASC)  -- 91.48
FROM FWB;

-- 2.2 Check for negative FWBscores
SELECT PUF_ID, FWB1_1, FWB1_2, FWB1_3, FWB1_4, FWB1_5, FWB1_6, FWB2_1, FWB2_2, FWB2_3, FWB2_4 FROM FWB
WHERE FWB1_1<0 OR FWB1_2<0 OR FWB1_3<0 OR FWB1_4<0 OR FWB1_5<0 OR FWB1_6<0 OR
	FWB2_1<0 OR FWB2_2<0 OR FWB2_3<0 OR FWB2_4<0
ORDER BY puf_id;
